# 异常值检测-Part1 Outlier Analysis

我们主要的领域是时间序列的异常值检测，所以就研究一下第8章：TIME SERIES AND MULTIDIMENSIONAL STREAMING OUTLIER DETECTION

## 1 简介

流式异常值检测。

对异常值的定义：

- 时间序列中的突变检测
  - 异常值定义为不寻常，表现出与其直接或长期历史缺乏连续性
  - 举例：值的突然变化或子序列的特殊形状
  - 纵向分析更为重要，将每个单独的序列视为一个单元，主要在该单元上进行分析
  - 若多个序列，则可以利用互相关，但这并不起主要作用（时间序列都是上下文相关的）
- 多维数据中的特异性和变化检测
  - 数据包含独立的多维数据点
  - 多维数据流中，异常可能对应于聚合趋势发生变化的时间点，也可能对应与这些聚合趋势不同的单个特异数据点
  - 上一条的第二种类型，对应于流数据中传入的数据点
  - 数据流的所有维度都被视为一个单元，通过聚合这些单元中的趋势来识别异常
  - 横向
  - 举例：文本数据流中关于特定主题的第一个故事，会被认为是特异性的异常值，如果这个数据流中主题的总体趋势是朝着目前这个“异常值”，那么经过一段时间后，类似的数据就不会被认为是特异的，而成为数据的正常部分。直接连续性上看，并不是那么重要，但总体趋势的重大变化仍然很重要。

时间序列中的异常值检测也可以分成两类：

- 上下文异常：特定时间戳的值发生突变，从而被归为异常值
- 集体异常：整个时间序列或时间序列中的大子序列因为不寻常的形状而被归为异常值

标签：可以使用标签来监督异常检测的过程。时间序列：标签可能与时间点、时间间隔相关，或者与整个序列相关；多维：标签与各个数据点相关。

时间数据允许定义多种异常。

2中介绍用于检测时间序列中异常时刻点算法，通常情况下是基于对时刻预测值的偏差检测。检测到的是上下文异常值。3中介绍时间序列数据中检测异常形状的算法，集体异常值。4中介绍多维流数据异常值检测。5总结。

## 2 基于预测的时间序列异常值检测

最普遍的是基于回归的预测模型，检测特定时间点的基于偏差的异常值。既可以用于检测数据流的突变，也可以用于过滤噪声。基于偏差的异常值和预测问题密切相关，因为异常值是根据预期与实际值的偏差来定义的。

时间连续性起重要的作用，因为我们做的假设是时间序列数据在连续瞬间相关，且不会发生突变。基于偏差的异常值检测需要使用各种回归模型获得下一个时间戳的预测值。于是就可以使用单个时间序列或者跨多个序列的相关性来进行预测。因此，使用两种相关性：

- **跨时间的相关性**：与时间连续性本质上差别不大，将一系列自回归模型用于预测和其他应用，将异常值定义为与预测值有显著偏差的值。显著偏差表现为突变，与数据流中出现的平稳、长期数据漂移不同。
- **跨序列的相关性**：传感器网络，导致时间序列通常彼此密切相关。eg：一个传感器检测到的污染，通常也会被附近的传感器检测到。这种情况下，可以用一个序列来预测另一个序列。与预测值偏差显著的可以标记为异常。

这里研究回归建模在时间序列数据中的应用。

### 2.1 自回归模型(AR)

适用于单变量时间序列中的上下文。令$X_1 ... X_t...$是单变量时间序列中的值。在自回归模型中，$X_t$的值是根据最后一个长度为$p$的窗里的数据确定的。
$$
X_t=\sum_{i=1}^p a_i\cdot X_{t-i}+c+\epsilon_t
$$
最后的长度为$p$的模型称为$AR(p)$模型。回归系数$a_1...a_p,c$需要从训练数据中学习，训练数据就是时间序列的历史数据。使用训练数据中的每个瞬间数据点，和其过去$p$长度的历史数据，就可以创建关于系数的一组线性方程组。如果可用的数据点远大于$p$，则为一个超定方程组。此时，系数$a_1...a_p,c$可以用最小二乘法近似，通过最小化平方误差来确定系统。

上面的方程组中，$c$是一个常数，$\epsilon_t$表示噪声，或者与预测值的偏差。绝对值较大的偏差会被认为是异常。长时间的可以用正态分布计算偏差的程度，短时间可以用t值检验估计偏差的程度。

再结合一个MA模型，就可以让AR模型更加鲁棒。MA模型：
$$
X_t=\sum_{i=1}^q b_i\cdot \epsilon_{t-i}+\mu+\epsilon_t
$$
一堆系数可以从历史数据中学习，将当前值与序列的平均值跟偏差历史相关联

然后一个很自然的想法就是把这俩结合起来，变成ARMA模型。增强了模型的表达能力，同时也有可能发生过拟合。
$$
X_t=\sum_{i=1}^p a_i\cdot X_{t-i}+\sum_{i=1}^q b_i\cdot \epsilon_{t-i}+c+\epsilon_t
$$
通常会选择较小的$p$和$q$值

### 2.2 多时间序列回归模型

不同的时间序列可能通常包含相同的信息，并且有时可能包含滞后相关性

#### 2.2.1 AR模型直接推广

数据$X_t^1\cdots X_t^d$
$$
X_t^j=\sum_{k=1}^d\sum_{i=1}^pa_i^k\cdot X_{t-i}^k+c^j+\epsilon_t^j
$$
较大的$\epsilon_t^j$会被报告为异常值

#### 2.2.2 PCA

对时间相关的表现较差，对序列间相关的表现较好

### 2.3 监督

上面的方法有很多可能是虚警。存在一个gt的时间戳->主要异常事件，剩下的作为次要异常事件，尽可能区分这二者，即这个模型与异常检测同时进行，目的是让这两个东西的距离最大化。

## 3 时间序列集体异常检测

可以分成两种，一种是全系列异常，第二种是时间序列窗口上检测到异常。我们这里讨论第二种。

### 3.1 转换成其他的表示方式

目的：将时间序列片段与其他部分相比较

第一种：数值多维变换。序列变换成多维向量，每个维度的表示对应于标准向量空间中的数值系数，这样可以用欧式距离来度量。

第二种：离散序列转换，用离散化将序列变成符号表示，转换成离散异常值检测问题。

#### 3.1.1 第一种

一个最简单的方式：将时间序列中长度为n的每个窗口看作是长度为n的多维向量，然后用小波变换或者是快速傅立叶变换之类的方法得到数值系数。

可以用最近邻距离或者k近邻距离作为一场分数。

挑战：大量的子序列。

#### 3.1.2 第二种

将连续时间序列转换成离散数据，然后当成离散数据异常检测来做。整体上来看就是一个聚合的过程来达到离散化的目的。
